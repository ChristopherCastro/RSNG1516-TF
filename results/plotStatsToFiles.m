% This scripts takes a set of results and plots a fucking ton of things for
% each set, saving those plots on image files. 
% WARNING: Does not support plotting more than 10 machines.



if exist('runSetsResults','var')
    for i=1:size(runSetsResults,2)
        runSet = runSetsResults{i};
        runSetConf = runSet{1};
        if runSetConf.machinesNumber>10
            disp('Error: Can not plot more than 10 machines');
        else
            runSetStats = runSet{2};
            %Fill 10-M empty machines stats to plot nothing
            for j=(runSetConf.machinesNumber+1):10
                runSetStats{j} = Stats();
            end
    %         fprintf('==========================\n');
            fprintf('Plotting runSet %d\n', i);
    %         fprintf('  - Machine Numbers: %d\n', runSetConf.machinesNumber);
    %         fprintf('  - Load Balancer: %d\n', runSetConf.loadBalancer);
    %         fprintf('  - Number of Clients: %d\n', runSetConf.numClients);
    %         fprintf('  - Threads Number: %d\n', runSetConf.nThreads);
    %         fprintf('  - Wait Queue Size: %d\n', runSetConf.waitQueueLen);
    %         fprintf('  - Event Generator: %d\n', runSetConf.eventsGenerator);
    %         fprintf('    · Event Generator (Lambda): %d\n', runSetConf.lambda);
    %         fprintf('    · Event Generator (Service Time): %d\n', runSetConf.tmService);

            baseFileName = sprintf('[M=%d][LB=%d][Nclients=%d][Nthreads=%d][WqLen=%d][eGen=%d][lambda=%d][tmServ=%d].png',...
                            runSetConf.machinesNumber, runSetConf.loadBalancer,...
                            runSetConf.numClients, runSetConf.nThreads,...
                            runSetConf.waitQueueLen,runSetConf.eventsGenerator,...
                            runSetConf.lambda, runSetConf.tmService);

            FigHandle = figure;
            set(FigHandle, 'Position', [100, 100, 1280, 800],'Visible','off','PaperPositionMode','auto');
            titulo = suptitle(baseFileName);
            set(FigHandle, 'visible', 'off'); %Yes, again. Messing with figure visibility because the fucking suptitle makes it visibile again.
            set(titulo,'FontSize',9,'FontWeight','normal');
            topLeft = subplot(2,2,1);
            topRight = subplot(2,2,2);
            bottomLeft = subplot(2,2,3);
            bottomRight = subplot(2,2,4);

            % Evolucion de numero de clientes esperando en cola en cada máquina
            plot(topLeft,runSetStats{1}.time, runSetStats{1}.countClientsWaiting,...
                runSetStats{2}.time, runSetStats{2}.countClientsWaiting,...
                runSetStats{3}.time, runSetStats{3}.countClientsWaiting,...
                runSetStats{4}.time, runSetStats{4}.countClientsWaiting,...
                runSetStats{5}.time, runSetStats{5}.countClientsWaiting,...
                runSetStats{6}.time, runSetStats{6}.countClientsWaiting,...
                runSetStats{7}.time, runSetStats{7}.countClientsWaiting,...
                runSetStats{8}.time, runSetStats{8}.countClientsWaiting,...
                runSetStats{9}.time, runSetStats{9}.countClientsWaiting,...
                runSetStats{10}.time, runSetStats{10}.countClientsWaiting);
            title(topLeft,'Numero clientes en cola');
            xlabel(topLeft,'tiempo');
            ylabel(topLeft,'clientes en cola');

            % Evolución del tiempo medio de espera en la cola
            plot(topRight,runSetStats{1}.time, runSetStats{1}.tMeanWaitQueue,...
                runSetStats{2}.time, runSetStats{2}.tMeanWaitQueue,...
                runSetStats{3}.time, runSetStats{3}.tMeanWaitQueue,...
                runSetStats{4}.time, runSetStats{4}.tMeanWaitQueue,...
                runSetStats{5}.time, runSetStats{5}.tMeanWaitQueue,...
                runSetStats{6}.time, runSetStats{6}.tMeanWaitQueue,...
                runSetStats{7}.time, runSetStats{7}.tMeanWaitQueue,...
                runSetStats{8}.time, runSetStats{8}.tMeanWaitQueue,...
                runSetStats{9}.time, runSetStats{9}.tMeanWaitQueue,...
                runSetStats{10}.time, runSetStats{10}.tMeanWaitQueue);
            title(topRight,'Tiempo medio espera en cola');
            xlabel(topRight,'tiempo');
            ylabel(topRight,'tMeanWaitQueue');

            % Ratio rechazados
            plot(bottomLeft,runSetStats{1}.time, runSetStats{1}.percentRejected,...
                runSetStats{2}.time, runSetStats{2}.percentRejected,...
                runSetStats{3}.time, runSetStats{3}.percentRejected,...
                runSetStats{4}.time, runSetStats{4}.percentRejected,...
                runSetStats{5}.time, runSetStats{5}.percentRejected,...
                runSetStats{6}.time, runSetStats{6}.percentRejected,...
                runSetStats{7}.time, runSetStats{7}.percentRejected,...
                runSetStats{8}.time, runSetStats{8}.percentRejected,...
                runSetStats{9}.time, runSetStats{9}.percentRejected,...
                runSetStats{10}.time, runSetStats{10}.percentRejected);
            title(bottomLeft,'% rechazos');
            xlabel(bottomLeft,'tiempo');
            ylabel(bottomLeft,'porcentaje rechazos');

            % Evolucion de ro en cada máquina
            plot(bottomRight,runSetStats{1}.time, runSetStats{1}.ro,...
                runSetStats{2}.time, runSetStats{2}.ro,...
                runSetStats{3}.time, runSetStats{3}.ro,...
                runSetStats{4}.time, runSetStats{4}.ro,...
                runSetStats{5}.time, runSetStats{5}.ro,...
                runSetStats{6}.time, runSetStats{6}.ro,...
                runSetStats{7}.time, runSetStats{7}.ro,...
                runSetStats{8}.time, runSetStats{8}.ro,...
                runSetStats{9}.time, runSetStats{9}.ro,...
                runSetStats{10}.time, runSetStats{10}.ro);
            title(bottomRight,'Rho medio');
            xlabel(bottomRight,'tiempo');
            ylabel(bottomRight,'Rho medio');
            

            %saveas(FigHandle,baseFileName);
            print(baseFileName,'-dpng','-r0')
        end %if maxmachines end
        
    end %for end
else
    disp('Error!: "runSetsResults" varable must exist on workspace!');
end